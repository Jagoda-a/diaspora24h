generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Article {
  id          String   @id @default(cuid())

  country     String
  language    String    @default("sr")

  title       String
  slug        String    @unique
  summary     String
  content     String?

  coverImage  String?
  sourceUrl   String?
  sourcesJson String?

  // Kategorija: default prebačen na "drustvo" (bolji fallback od "nepoznato")
  category    String    @default("drustvo")

  // Tema/anti-dupe ključ (opciono)
  topicKey    String?

  // Timestamps
  publishedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  // --- SEO ---
  seoTitle        String?
  seoDescription  String?
  ogImage         String?
  canonicalUrl    String?
  noindex         Boolean?

  // Prevedeni sadržaji (ako koristiš)
  translationsJson String?

  // --- Re-classify meta (opciono, ali korisno za audit) ---
  reclassifiedAt  DateTime?
  categoryPrev    String?

  // ----- Indeksi -----
  // već postojećI:
  @@index([category, publishedAt])
  @@index([createdAt])
  @@index([sourceUrl])

  // dodati:
  @@index([category], name: "idx_article_category_only")
  @@index([publishedAt, createdAt], name: "idx_article_published_created")
  @@index([country], name: "idx_article_country")
  @@index([language], name: "idx_article_language")

  // kompozitni unique: ne dozvoljava dve vesti iste teme u istoj zemlji
  // (u Postgresu više NULL vrednosti je dozvoljeno – migracija bez zastoja)
  @@unique([topicKey, country], name: "uq_article_topickey_country")
}
